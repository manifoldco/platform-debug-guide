{"version":3,"sources":["webpack:///./node_modules/@manifoldco/ui/dist/esm-es5/manifold-performance.entry.js","webpack:///./node_modules/@manifoldco/ui/dist/esm-es5/errorReport-fd9a1346.js","webpack:///./node_modules/@manifoldco/ui/dist/esm-es5/logger-2d4b1cd8.js","webpack:///./node_modules/@manifoldco/ui/dist/esm-es5/loadMark-3d3a666d.js"],"names":["__decorate","decorators","target","key","desc","d","c","arguments","length","r","Object","getOwnPropertyDescriptor","Reflect","decorate","i","defineProperty","loggableEvents","ManifoldPerformance","hostRef","_this","this","logQueue","ddLoadListener","window","DD_LOGS","ddLogs","init","clientToken","forwardErrorsToLogs","addLoggerGlobalContext","forEach","logMetric","e","type","detail","token","expiry","error","logger","assign","info","push","prototype","componentDidLoad","eventType","addEventListener","componentDidUnload","ddScript","removeEventListener","observer","disconnect","componentDidRender","componentWillLoad","render","src","ref","el","get","enumerable","configurable","report","element","extendedDetail","componentName","tagName","npmVersion","console","evt","CustomEvent","bubbles","document","dispatchEvent","_propertyKey","descriptor","originalMethod","value","rendered","apply","performanceLoadMark","performanceRenderedMark","constructor","name","startsWith","hasSkeletonElements","$tag$","$children$","map","includes","performance","now","component","duration","message","loadMark","_target"],"mappings":"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","file":"41.06fd054ff1d87873555e.js","sourcesContent":["import { r as registerInstance, h, g as getElement } from './core-1b19af26.js';\nimport './errorReport-fd9a1346.js';\nimport { l as logger } from './logger-2d4b1cd8.js';\nimport { l as loadMark } from './loadMark-3d3a666d.js';\nvar __decorate = (undefined && undefined.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\")\n        r = Reflect.decorate(decorators, target, key, desc);\n    else\n        for (var i = decorators.length - 1; i >= 0; i--)\n            if (d = decorators[i])\n                r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar loggableEvents = [\n    'manifold-rest-fetch-duration',\n    'manifold-graphql-fetch-duration',\n    'manifold-error',\n    'manifold-time-to-render',\n    'receiveManifoldToken',\n];\nvar ManifoldPerformance = /** @class */ (function () {\n    function ManifoldPerformance(hostRef) {\n        var _this = this;\n        registerInstance(this, hostRef);\n        this.logQueue = [];\n        this.ddLoadListener = function () {\n            if (window.DD_LOGS) {\n                _this.ddLogs = window.DD_LOGS;\n            }\n            _this.ddLogs.init({\n                clientToken: 'pub17f4dfbc39a8b0e89f09f2720a035651',\n                forwardErrorsToLogs: false,\n            });\n            _this.ddLogs.addLoggerGlobalContext('browser-source', 'manifold-ui');\n            _this.logQueue.forEach(_this.logMetric);\n            _this.logQueue = [];\n        };\n        this.logMetric = function (e) {\n            if (e.type === 'receiveManifoldToken' && !e.detail.token) {\n                // Only log duration if token is defined\n                return;\n            }\n            if (e.type === 'receiveManifoldToken') {\n                delete e.detail.token;\n                delete e.detail.expiry;\n            }\n            if (!_this.ddLogs) {\n                _this.logQueue.push(e);\n                return;\n            }\n            if (e.type === 'manifold-error' || (e.type === 'receiveManifoldToken' && e.detail.error)) {\n                _this.ddLogs.logger.error(e.type, Object.assign({ type: e.type }, e.detail));\n            }\n            else {\n                _this.ddLogs.logger.info(e.type, Object.assign({ type: e.type }, e.detail));\n            }\n        };\n    }\n    ManifoldPerformance.prototype.componentDidLoad = function () {\n        var _this = this;\n        loggableEvents.forEach(function (eventType) { return window.addEventListener(eventType, _this.logMetric); });\n    };\n    ManifoldPerformance.prototype.componentDidUnload = function () {\n        var _this = this;\n        this.ddScript.removeEventListener('load', this.ddLoadListener);\n        loggableEvents.forEach(function (eventType) { return window.removeEventListener(eventType, _this.logMetric); });\n        this.observer.disconnect();\n    };\n    ManifoldPerformance.prototype.componentDidRender = function () {\n        this.ddScript.addEventListener('load', this.ddLoadListener);\n        if (window.DD_LOGS || this.ddLogs) {\n            this.ddLoadListener();\n        }\n    };\n    ManifoldPerformance.prototype.componentWillLoad = function () { };\n    ManifoldPerformance.prototype.render = function () {\n        var _this = this;\n        return (h(\"script\", { type: \"text/javascript\", src: \"https://www.datadoghq-browser-agent.com/datadog-logs-us.js\", ref: function (el) {\n                _this.ddScript = el;\n            } }));\n    };\n    Object.defineProperty(ManifoldPerformance.prototype, \"el\", {\n        get: function () { return getElement(this); },\n        enumerable: true,\n        configurable: true\n    });\n    return ManifoldPerformance;\n}());\n__decorate([\n    loadMark()\n], ManifoldPerformance.prototype, \"componentWillLoad\", null);\n__decorate([\n    logger()\n], ManifoldPerformance.prototype, \"render\", null);\nexport { ManifoldPerformance as manifold_performance };\n","/* eslint-disable somethnig */\nfunction report(detail, element) {\n    var extendedDetail = Object.assign(Object.assign(Object.assign({}, detail), (element ? { componentName: element.tagName } : {})), { npmVersion: '0.6.4' });\n    console.error(detail); // report error (Rollbar, Datadog, etc.)\n    var evt = new CustomEvent('manifold-error', { bubbles: true, detail: extendedDetail });\n    (element || document).dispatchEvent(evt);\n}\nexport { report as r };\n","import { h } from './core-1b19af26.js';\nimport { r as report } from './errorReport-fd9a1346.js';\nfunction hasSkeletonElements(rendered) {\n    if (rendered &&\n        rendered.$tag$ &&\n        rendered.$tag$.startsWith &&\n        rendered.$tag$.startsWith('manifold-skeleton-')) {\n        return true;\n    }\n    if (rendered && rendered.$children$) {\n        return rendered.$children$.map(function (c) { return hasSkeletonElements(c); }).includes(true);\n    }\n    return false;\n}\n/* eslint-disable no-param-reassign */\nfunction logger() {\n    return function loggerDecorator(target, _propertyKey, descriptor) {\n        var originalMethod = descriptor.value;\n        descriptor.value = function render() {\n            try {\n                var rendered = originalMethod.apply(this); // attempt to call render()\n                if (this.performanceLoadMark &&\n                    !this.performanceRenderedMark &&\n                    target.constructor.name.startsWith('Manifold') &&\n                    !hasSkeletonElements(rendered)) {\n                    this.performanceRenderedMark = performance.now();\n                    var evt = new CustomEvent('manifold-time-to-render', {\n                        bubbles: true,\n                        detail: {\n                            component: target.constructor.name,\n                            duration: this.performanceRenderedMark - this.performanceLoadMark,\n                        },\n                    });\n                    document.dispatchEvent(evt);\n                }\n                return rendered;\n            }\n            catch (e) {\n                var detail = {\n                    componentName: target.constructor.name,\n                    error: e.message,\n                    npmVersion: '0.6.4',\n                };\n                report(detail);\n                return h(\"manifold-toast\", { \"alert-type\": \"error\" }, e.message); // show error to user\n            }\n        };\n        return descriptor;\n    };\n}\nexport { logger as l };\n","/* eslint-disable no-param-reassign */\nfunction loadMark() {\n    return function loadMarkDecorator(_target, _propertyKey, descriptor) {\n        var originalMethod = descriptor.value;\n        descriptor.value = function componentWillLoad() {\n            this.performanceLoadMark = performance.now();\n            return originalMethod.apply(this); // call original method\n        };\n        return descriptor;\n    };\n}\nexport { loadMark as l };\n"],"sourceRoot":""}